# Тестовое задание для ООО Mindbox
Тестовое задание по созданию манифеста k8s на позицию стажера SRE.
___

Задание выполнялось в тестовом кластере minikube, настройка кластера выполнена по документации https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/
https://kubernetes.io/ru/docs/tasks/tools/install-minikube/
___

##  :clipboard: Вводные данные

:pushpin: У нас мультизональный кластер (три зоны), в котором пять нод

:pushpin: Приложение требует около 5-10 секунд для инициализации

:pushpin: По результатам нагрузочного теста известно, что 4 пода справляются с пиковой нагрузкой
а первые запросы приложению требуется значительно больше ресурсов CPU, в дальнейшем потребление ровное в районе 0.1 CPU. По памяти всегда “ровно” в районе 128M memory

:pushpin: Приложение имеет дневной цикл по нагрузке – ночью запросов на порядки меньше, пик – днём

:pushpin: Xотим максимально отказоустойчивый deployment

:pushpin: Xотим минимального потребления ресурсов от этого deployment’а

___

## :computer: Ход выполнения задания

*Можно сразу перейти к комментариям кода в самом манифесте.

После указания служебной информации для определения деплоймента, было указано количество запускаемых подов(4) по умолчанию.

Количество подов после запуска деплоймента в дальнейшем будет регулироваться с помощью HPA(HorizontalPodAutoscaler).

Далее происходит описание подов, включающее в себя описание контейнеров с ограничением на количество ресурсов по заданию.

Порт контейнера для веб приложения - 80, в блоке кода resources указано описание ресурсов для каждого контейнера, требуется выделять 128M ОЗУ и 0.1 CPU.

limits указывает на максимальное количество ресурсов, которые контейнер может взять у хоста. Если не указать конкретное количество CPU, контейнер может забрать лишние ресурсы у хоста и навредить работе других контейнеров.

readinessProbe и livenessProbe отвечают за проверку готовности и живости контейнеров соответственно. В ТЗ указано, что приложение требует около 5-10 секунд для инициализации, таким образом для проверки готовности контейнера установлена задержка на 5 секунд и период повторной проверки 10 секунд. Для проверки живости установлена задержа 10 и 15 секунд для первой проверки и повторных соответственно.

Пути в httpGet блоках могут изменяться в зависимости от требований, по умолчанию для проверки готовности и живости используется /health и ожидается HTTP ответ 200 OK.

Далее описываю HPA для масштабирования. Так же производится описание мета информации и в строке spec.scaleTargetRef.name указывается имя деплоймента, к которому будет применяться масштабирование.

Строки minReplicas и maxReplicas указывают на минимальное и максимальное количество подов, которые могут быть созданы в зависимости от нагрузки на них.

Блок кода metrics задает процент утилизации CPU, при превышении которого будут создаваться новые поды, при отсутствии нагрузки количество подов будет уменьшаться.

___

## :white_check_mark: Итог

В ходе работы был написан манифест для создания деплоймента в k8s соответствующий требованиям ТЗ.

## :books: Источники

https://kubernetes.io/docs/home/

https://docs.docker.com/manuals/

https://www.youtube.com

https://www.google.com/
